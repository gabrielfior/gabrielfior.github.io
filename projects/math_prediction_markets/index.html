
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Simple math for back-of-the-envelope calculations related to Prediction Markets">
      
      
      
        <link rel="canonical" href="https://gabrielfior.github.io/projects/math_prediction_markets/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Math for Prediction Markets - Gabriel Fior</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#napkin-math-for-binary-prediction-markets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Gabriel Fior" class="md-header__button md-logo" aria-label="Gabriel Fior" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gabriel Fior
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Math for Prediction Markets
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Gabriel Fior" class="md-nav__button md-logo" aria-label="Gabriel Fior" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Gabriel Fior
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AI
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-case" class="md-nav__link">
    <span class="md-ellipsis">
      Special case
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-case" class="md-nav__link">
    <span class="md-ellipsis">
      General case
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="napkin-math-for-binary-prediction-markets">Napkin math for Binary Prediction Markets</h1>
<p>We want to prove 2 useful equations for calculating the potential payoff for a binary prediction market powered by an automated market maker:</p>
<p>For a market with equal odds:</p>
<p>(1) <script type="math/tex; mode=display"> t_y = 2 * bet_{amount}</script>
</p>
<p>For any market:</p>
<p>(2) <script type="math/tex; mode=display">t_y = \frac{bet_{amount}}{1 - p_y}</script>
</p>
<p>where </p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>$bet_{amount}$</td>
<td>Amount placed in the bet transaction</td>
</tr>
<tr>
<td>$t_y$</td>
<td>Number of YES outcome tokens obtained by wagering $bet_{amount}$</td>
</tr>
<tr>
<td>$p_y$</td>
<td>Probability that the market resolves to YES</td>
</tr>
<tr>
<td>$p_n$</td>
<td>Probability that the market resolves to NO</td>
</tr>
</tbody>
</table>
<h2 id="introduction">Introduction</h2>
<p>Let's start with a <a href="https://docs.gnosis.io/conditionaltokens/docs/introduction3/">Prediction Market</a> that has equal odds ($p_y = p_n = 0.5$) and adheres by the Constant Product Market Maker (CPMM) mechanism (similar to <a href="https://uniswap.org/whitepaper.pdf">Uniswap v2</a>).</p>
<p>We highlight the following parallels between CPMM Prediction markets and constant-product AMMs:</p>
<table>
<thead>
<tr>
<th>Concept</th>
<th>AMM</th>
<th>CPMM</th>
<th>Invariant is conserved?</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add liquidity</td>
<td>The tokens A and B of the AMM are deposited and, in exchange, the depositor receives LP tokens</td>
<td>The market creator makes a single-sided deposit of N collateral tokens and 2N outcome tokens are created, N YES and N NO, and are kept in the market's reserves, while shares are minted that belong to the creator (ERC-1155 pattern)</td>
<td>No</td>
</tr>
<tr>
<td>Trade</td>
<td>User can swap token A for token B and vice-versa. Invariant is conserved.</td>
<td>User can place bets on outcome YES or NO. User makes a single-sided deposit of collateral tokens and a transfer of a corresponding amount of YES or NO tokens is made from the market's contract to the better's address. Invariant is conserved.</td>
<td>Yes</td>
</tr>
<tr>
<td>Remove liquidity</td>
<td>LP tokens are burned by the sender, leading to the tokens A and B stored in the pool to be sent to the sender.</td>
<td>Similarly to the AMM case, shares are burnt and the proportional amount of collateral tokens from the market's reserves is transferred to the sender. Invariant is not conserved.</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>As an example (based on <a href="https://docs.gnosis.io/conditionaltokens/docs/introduction3/#an-example-with-cpmm">Gnosis' tutorial</a>), we illustrate a situation where a market is created and someone wants to place a bet on said market.</p>
<ul>
<li>Digi creates a new CPMM market with 10 xDAI - this creates 10 YES tokens and 10 NO tokens, which are added to the market's reserves<ul>
<li>Note that n xDAI will always be converted in n YES tokens and n NO tokens on binary markets - this is a feature of prediction markets.</li>
<li>Note also that the CPMM invariant ($x * y = k$) is set to $100$ by the creator (product of the 2 outcome tokens in the reserves)</li>
</ul>
</li>
<li>Alice wants to bet 10 xDAI on the YES outcome, i.e. that it will resolve to YES. The individual steps are:<ul>
<li>She adds 10 xDAI to the market, which mints 10 Yes tokens and 10 NO tokens, adding this to the market's reserves</li>
<li>The new CPMM invariant is $20 * 20 = 400$, which is broken.</li>
<li>By sending 15 YES tokens to Alice, the invariant is restored, since $5 * 20 = 100$</li>
<li>We will see below how to calculate that the number of YES outcome tokens Alice was entitled to was indeed 15.</li>
</ul>
</li>
</ul>
<h2 id="special-case">Special case</h2>
<p>We consider a special case where the market odds are aligned, i.e. the YES outcome is exactly as likely (from the market's perspective) as the NO outcome.</p>
<p>The deduction starts immediately before Alice's trade and is based on the following observations:
- The market was balanced, i.e. the number of YES- and NO outcome tokens was the same ($s$)
- By placing trades, the CPMM invariant ($k$) must remain constant
- Alice wants to trade $b$ xDAI units in exchange for $t$ YES outcome tokens</p>
<p>By conservation of the invariant $k$:</p>
<p>
<script type="math/tex; mode=display"> (s  + b - t)(s + b) = s^2</script>
<script type="math/tex; mode=display"> (s + b) - \frac{s^2}{s+b} = t </script>
<script type="math/tex; mode=display"> \frac{(s^2 + 2sb + b^2) - s^2}{s+b} = t </script>
<script type="math/tex; mode=display"> \frac{2sb + b^2}{s+b} = t </script>
</p>
<p>Now we observe that $b &lt;&lt; s$, i.e. for large enough markets, the market's reserves are much larger than the individual bet amounts. In that case, we can simplify this further:</p>
<p>
<script type="math/tex; mode=display"> t = \frac{2sb}{s} </script>
<script type="math/tex; mode=display"> t = 2b </script>
</p>
<p>Thus we have proved (1).</p>
<h2 id="general-case">General case</h2>
<p>Now we want to generalize the individual case for the case where the market is not balanced, i.e. where the odds for each outcome are different. To illustrate this difference, we introduce $p_y$ and $p_n$ to reflect the market's odds.</p>
<p>We also note that:</p>
<p>
<script type="math/tex; mode=display"> p_y = 1 - p_n</script>
<script type="math/tex; mode=display"> p_n = \frac{n_0}{n_0 + y_0}</script>
</p>
<p>where $n_0$ is the amount of NO outcome tokens in the market's reserves and similarly $y_0$ the amount of YES outcome tokens.</p>
<p>Again we start with the conservation of the CPMM invariant:</p>
<p>
<script type="math/tex; mode=display">(y_0 + b - t)(n_0 + b) = y_0  n_0 </script>
<script type="math/tex; mode=display">(y_0 + b - t) = \frac{y_0 n_0}{n_0 + b} </script>
<script type="math/tex; mode=display"> y_0 + b - \frac{y_0 n_0}{n_0 + b} = t </script>
<script type="math/tex; mode=display"> \frac{(y_0 + b)(n_0+b) - y_0 n_0}{n_0 + b} = t </script>
<script type="math/tex; mode=display"> \frac{(y_0 + n_0)b}{n_0+b} + \frac{b^2}{n_0+b} = t </script>
</p>
<p>We use the same trick as above and assume that $b &lt;&lt; n_0$. This leads to the 2nd term being deemed negligible.
Furthermore, we use the fact that $y_0 + n_0 = \frac{n_0}{p_n}$, so that the expression becomes:</p>
<p>
<script type="math/tex; mode=display"> \frac{(y_0 + n_0)b}{n_0+b} = t </script>
<script type="math/tex; mode=display"> \frac{n_0}{p_n}\frac{b}{n_0+b} = t </script>
</p>
<p>We again make use of the fact that $b &lt;&lt; n_0$ and simplify the 2nd term in the denominator, leading us to the final result:</p>
<p>
<script type="math/tex; mode=display"> \frac{n_0}{p_n}\frac{b}{n_0} = t </script>
<script type="math/tex; mode=display"> \frac{b}{p_n} = t </script>
<script type="math/tex; mode=display"> t = \frac{b}{(1 - p_y)} </script>
</p>
<p>Observe that (2) is the generalized version of (1) for binary prediction markets with arbitrary odds.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We hope the calculations above, albeit simple, can be helpful to other people looking to play around with Prediction Markets, helping with simple back-of-the-envelope calculations related to outcome tokens received after placing bets.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>